<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Management Studio – JSON SQL (Read-Only)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2">
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark mb-2">
      <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">Management Studio – JSON SQL (Read-Only)</span>
        <span class="navbar-text text-warning">SELECT/EXPLAIN/PRAGMA/WITH only</span>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row g-2">
        <!-- Left: Tables -->
        <div class="col-12 col-lg-3">
          <div class="card mb-2">
            <div class="card-header d-flex align-items-center justify-content-between">
              <strong>Stage0 Outbox</strong>
              <button id="refreshOutbox" class="btn btn-sm btn-outline-secondary">Neu laden</button>
            </div>
            <div class="card-body p-2 small" style="max-height: 20vh; overflow: auto;">
              <div class="mb-1"><code id="outboxRoot">…</code></div>
              <ul id="outboxList" class="list-group list-group-flush"></ul>
            </div>
          </div>
          <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
              <strong>Tabellen</strong>
              <button id="refreshTables" class="btn btn-sm btn-outline-secondary">Neu laden</button>
            </div>
            <div class="card-body p-2" style="max-height: 40vh; overflow: auto;">
              <ul id="tablesList" class="list-group list-group-flush small"></ul>
            </div>
          </div>
          <div class="card mt-2">
            <div class="card-header d-flex align-items-center justify-content-between">
              <strong>Views</strong>
              <button id="refreshViews" class="btn btn-sm btn-outline-secondary">Neu laden</button>
            </div>
            <div class="card-body p-2" style="max-height: 20vh; overflow: auto;">
              <ul id="viewsList" class="list-group list-group-flush small"></ul>
            </div>
          </div>
          <div class="card mt-2">
            <div class="card-header d-flex align-items-center justify-content-between">
              <strong>CLI Tabellen</strong>
              <button id="refreshCliTables" class="btn btn-sm btn-outline-secondary">Neu laden</button>
            </div>
            <div class="card-body p-2" style="max-height: 20vh; overflow: auto;">
              <ul id="cliTablesList" class="list-group list-group-flush small"></ul>
            </div>
          </div>
          <div class="card mt-2">
            <div class="card-header d-flex align-items-center justify-content-between">
              <strong>Gespeicherte Prozeduren</strong>
              <button id="refreshCli" class="btn btn-sm btn-outline-secondary">Neu laden</button>
            </div>
            <div class="card-body p-2">
              <form id="cliForm" class="small">
                <div class="mb-1">
                  <label class="form-label mb-0">Prozedur</label>
                  <select id="cliProc" class="form-select form-select-sm">
                    <option value="pivot_case">pivot_case</option>
                  </select>
                </div>
                <div class="mb-1">
                  <label class="form-label mb-0">target_yyyymm</label>
                  <input id="cliTarget" type="number" class="form-control form-control-sm" placeholder="z. B. 202507" required>
                </div>
                <div class="mb-1 d-flex gap-1">
                  <div>
                    <label class="form-label mb-0">years</label>
                    <input id="cliYears" type="number" class="form-control form-control-sm" value="2">
                  </div>
                  <div>
                    <label class="form-label mb-0">month</label>
                    <input id="cliMonth" type="number" class="form-control form-control-sm" value="12">
                  </div>
                </div>
                <div class="mb-1 d-flex gap-1">
                  <div class="flex-fill">
                    <label class="form-label mb-0">scope</label>
                    <select id="cliScope" class="form-select form-select-sm">
                      <option value="same-file">same-file</option>
                      <option value="all">all</option>
                    </select>
                  </div>
                  <div class="flex-fill">
                    <label class="form-label mb-0">threshold</label>
                    <select id="cliThreshold" class="form-select form-select-sm">
                      <option value="optimal">optimal</option>
                      <option value="std05">std05</option>
                      <option value="f1">f1</option>
                      <option value="precision">precision</option>
                      <option value="recall">recall</option>
                    </select>
                  </div>
                </div>
                <div class="mb-1 d-flex gap-1">
                  <div class="flex-fill">
                    <label class="form-label mb-0">base</label>
                    <select id="cliBase" class="form-select form-select-sm">
                      <option value="churned">churned</option>
                      <option value="all">all</option>
                    </select>
                  </div>
                  <div class="flex-fill">
                    <label class="form-label mb-0">save_table</label>
                    <input id="cliTable" type="text" class="form-control form-control-sm" placeholder="leer = auto">
                  </div>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="1" id="cliOverwrite">
                  <label class="form-check-label" for="cliOverwrite">
                    Vorhandene Tabelle gleichen Namens überschreiben
                  </label>
                </div>
                <div class="mb-2">
                  <label class="form-label mb-0">Admin-Passwort</label>
                  <input id="cliPwd" type="password" class="form-control form-control-sm" placeholder="erforderlich für Ausführen/Löschen">
                </div>
                <div class="d-grid">
                  <button id="cliRun" type="submit" class="btn btn-sm btn-primary">Prozedur ausführen</button>
                </div>
              </form>
              <hr class="my-2"/>
              <div style="max-height: 20vh; overflow:auto;">
                <ul id="cliList" class="list-group list-group-flush small"></ul>
              </div>
            </div>
          </div>
          <div class="card mt-2">
            <div class="card-header"><strong>Tabellen-Schema</strong></div>
            <div class="card-body p-2 small" id="schemaBox" style="max-height: 40vh; overflow: auto;">
              <div class="text-muted">Wählen Sie eine Tabelle aus.</div>
            </div>
          </div>
        </div>

        <!-- Center: SQL Editor -->
        <div class="col-12 col-lg-9">
          <div class="card mb-2">
            <div class="card-header d-flex align-items-center justify-content-between">
              <strong>SQL-Editor</strong>
              <div>
                <input type="number" id="rowLimit" class="form-control form-control-sm d-inline-block" style="width: 100px;" value="10000" min="1" max="10000" title="Zeilenlimit">
                <button id="saveView" class="btn btn-sm btn-outline-success ms-2" title="Aktuelle Query als View speichern">+ View</button>
                <button id="runQuery" class="btn btn-sm btn-primary ms-2">Ausführen (⌘/Ctrl+Enter)</button>
              </div>
            </div>
            <div class="card-body p-0">
              <textarea id="sqlEditor" class="form-control" rows="6" spellcheck="false">SELECT * FROM backtest_results LIMIT 50;</textarea>
            </div>
          </div>

          <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
              <strong>Ergebnis</strong>
              <div id="resultMeta" class="small text-muted"></div>
            </div>
            <div class="card-body">
              <div id="resultContainer" class="table-responsive">
                <table id="resultTable" class="table table-striped table-sm" style="width:100%">
                  <thead></thead>
                  <tbody></tbody>
                </table>
              </div>
              <div id="errorBox" class="alert alert-danger d-none mt-2"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}?v=2"></script>
  </body>
  </html>


